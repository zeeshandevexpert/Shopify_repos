!function(){function e(){new t}var t=function(){var a,t,o,e,n,s,r=[],c=!1,i=0,u=0,h=!1,d=!1,l=function(e,t,a){var o;if(a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3),o="; expires="+n.toGMTString()}else o="";document.cookie=e+"="+t+o+"; path=/"},p=function(e){for(var t=e+"=",a=document.cookie.split(";"),o=0;o<a.length;o++){for(var n=a[o];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return null},f=function(e,t){var a=(t||document).querySelector(e);return a||(this.error=!0,null)},m=function(e,t){function r(e,t){return void 0===e?t:e}function a(e,t,a,o){if(t=r(t,2),a=r(a,","),o=r(o,"."),isNaN(e)||null==e)return 0;var n=(e=(e/100).toFixed(t)).split(".");return n[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+a)+(n[1]?o+n[1]:"")}var o="",n=/\{\{\s*(\w+)\s*\}\}/,s=t||this.money_format;switch("string"==typeof e&&(e=e.replace(".","")),s.match(n)[1]){case"amount":o=a(e,2);break;case"amount_no_decimals":o=a(e,0);break;case"amount_with_comma_separator":o=a(e,2,".",",");break;case"amount_no_decimals_with_comma_separator":o=a(e,0,".",",")}return s.replace(n,o)},_=function(){var e=0;if(null!=p("checkout-share-opens-count")&&0==isNaN(p("checkout-share-opens-count")))e=parseInt(p("checkout-share-opens-count"));return l("checkout-share-opens-count",e+1,30),e+1},y=function(){if(1==i)var t=parseFloat(m(n.total_price,"{{amount}}").replace(",","").replace(/[^0-9.,]+/,"")),e=s.pre_rules;else t=parseFloat(Shopify.checkout.total_price),e=s.post_rules;var a=!0,o=[];return e.forEach(function(e){2==e.rule_scope&&o.push(e)}),e.forEach(function(e){a=3==e.condition?a&&t>e.value:a&&t<e.value}),a},v=function(e,t){var a=[];return e.forEach(function(e){e.product_id==t&&a.push(e)}),a},g=function(){var t=!0,a=[];if(1==i){var o=n.items;s.pre_rules.forEach(function(e){1==e.rule_scope&&1==e.filter_object&&a.push(e)})}else{o=Shopify.checkout.line_items;s.post_rules.forEach(function(e){1==e.rule_scope&&1==e.filter_object&&a.push(e)})}return a.forEach(function(e){t=1==e.condition?t&&0<v(o,e.value).length:t&&0==v(o,e.value).length}),t},k=function(){return y()&&g()},w=function(){if(2==i){var e=0,t=s.post_title;if(1==s.post_incentive_active)if(1==k()){e=2;t=s.post_incentive_title}else 1==s.post_active&&(e=1);else 1==s.post_active&&(e=1);if(0<e){var a="https://checkoutshare.spacesquirrel.net/sharing/"+Shopify.shop+"/"+Shopify.checkout.order_id+"/"+e;Shopify.Checkout.OrderStatus.addContentBox("<h2>"+t+"</h2>",'<iframe id="share-a-purchase-wrap-frame" style="border:none;width:100%;height:525px;" src="'+a+'"></iframe>'),1==s.hide_map&&(document.querySelector(".map").style.display="none")}}else if(1==i&&"true"!=p("checkout-share-shared")){var o=_(),n=s.pre_incentive_hide_on_cart_page,r=s.pre_incentive_hide_on_ajax_add;if(0==isNaN(s.open_limit)&&o>parseInt(s.open_limit))return;if(1==n&&1==u)return;if(1==r&&2==u)return;1==s.pre_incentive_active&&1==k()?b(2):1==s.pre_active&&b(1)}},S=function(){0==h&&(h=!0,1==i&&(jQuery.getJSON("/cart.js",{},function(e){n=e,0==c&&o&&o.getAttribute("data-frame-loaded")&&(c=!0,o.contentWindow.postMessage({checkoutshare:!0,"checkoutshare-msg":"cartData","checkoutshare-msg-data":n},"*"))}),e="https://checkoutshare.spacesquirrel.net/sharing_cart/"+Shopify.shop,(t=document.createElement("div")).setAttribute("id","share-a-purchase-wrap-modal"),t.style.visibility="hidden",t.style.position="absolute",t.style.left="-999em",t.style.top="0px",t.style.width="100%",t.style.height="100%",t.style.zIndex="2147483647",t.style.overflow="hidden",(o=document.createElement("iframe")).style.width="100%",o.style.maxWidth="100%",o.style.height="100%",o.setAttribute("frameborder","0"),o.setAttribute("scrolling","no"),o.setAttribute("src",e),t.appendChild(o),document.body.appendChild(t),o.onload=function(){o.setAttribute("data-frame-loaded","yes"),n&&0==c&&(c=!0,o.contentWindow.postMessage({checkoutshare:!0,"checkoutshare-msg":"cartData","checkoutshare-msg-data":n},"*"))}))},b=function(e){1==i?(o.contentWindow.postMessage({checkoutshare:!0,"checkoutshare-msg":"modalType","checkoutshare-msg-data":{dialogType:e,shareFor:i}},"*"),t.style.visibility="visible",t.style.position="fixed",t.style.left="0px",o.contentWindow.focus()):f("#share-a-purchase-wrap-frame").contentWindow.postMessage({checkoutshare:!0,"checkoutshare-msg":"modalType","checkoutshare-msg-data":{dialogType:e,shareFor:i}},"*")},x=function(){t.style.visibility="hidden",t.style.position="absolute",t.style.left="-999em"},j={afterShare:function(){l("checkout-share-shared","true",1)},setShopData:function(e,t){s=t},addToCart:function(e,t){jQuery.post("/cart/add.js",{quantity:1,id:t},function(e){o.contentWindow.postMessage({checkoutshare:!0,"checkoutshare-msg":"addedToCart","checkoutshare-msg-data":e},"*")},"json")},openShare:function(){w()},cartData:function(e,t){cart_items=t.items,cart_products=t.items,setupTemplate()},modalClosed:function(){x()},setHeight:function(e,t){(a=f("#share-a-purchase-wrap-frame"))&&0<t&&(a.style.height=t+"px")}},C=function(){0==d&&(d=!0,window.addEventListener("message",function(e){try{~e.origin.indexOf("https://checkoutshare.spacesquirrel.net")&&1==e.data.checkoutshare&&j[e.data["checkoutshare-msg"]](e,e.data["checkoutshare-msg-data"])}catch(t){console.log(t)}}))},T=function(){if(Shopify.Checkout&&Shopify.Checkout.OrderStatus&&Shopify.Checkout.OrderStatus.addContentBox){i=2;var e=new XMLHttpRequest;e.open("GET","https://checkoutshare.spacesquirrel.net/shopdata/"+Shopify.shop,!0),e.onload=function(){200<=e.status&&e.status<400&&(1!=(s=JSON.parse(e.responseText)).post_active&&1!=s.post_incentive_active||(S(),C(),w()))},e.onerror=function(){},e.send()}else"/cart"!=window.location.pathname&&"/cart/"!=window.location.pathname||(u=i=1,S(),C()),window.jQuery&&jQuery(document).ajaxSuccess(function(e,t,a){"/cart/add.js"!=a.url&&"/cart/add.json"!=a.url||(i=1,u=2,S(),C())})};this.publicMethod=function(){return r},T()};"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?e():document.addEventListener("DOMContentLoaded",e,!1)}();
class CompleteTheLook extends HTMLElement{constructor(){super();this.items=this.querySelectorAll(".complete-the-look__item");this.selectedColor=document.querySelector('.product .product-form__option input[name="Color"]:checked').value;this.items.forEach(a=>{a.addEventListener("change",this.onItemChange.bind(this));this.updateOptions(a)});document.addEventListener("variant:changed",this.onVariantChanged.bind(this));this.swiperSetup();this.updateImages()}swiperSetup(){const a=this.querySelector(".complete-the-look__swiper"),
b=()=>{a.swiper.on("activeIndexChange",function(){const f=a.swiper.activeIndex;this.querySelector(".complete-the-look__current-look-value").innerHTML=f+1})},c=setInterval(()=>{a.swiper&&(b(),clearInterval(c))},1E3)}updateImages(){this.querySelectorAll(".complete-the-look__left .complete-the-look__item").forEach(a=>{let b=!1;JSON.parse(a.dataset.json).variants.forEach(c=>{-1===c.options.indexOf(this.selectedColor)||b||(updateSrcSet(a.querySelector("img"),c.featured_image.src),b=!0)})})}onVariantChanged(a){this.selectedColor=
document.querySelector('.product .product-form__option input[name="Color"]:checked').value;console.log("onVariantChanged");a=a.detail;const b=this.querySelector(".complete-the-look__main-item").querySelector(".complete-the-look__image img");updateSrcSet(b,a.featured_image.src);this.querySelectorAll(`input[value="${this.selectedColor}"]`).forEach(c=>{1<JSON.parse(c.closest(".complete-the-look__item").dataset.json).options.length&&(c.checked=!0)});this.updateImages()}updateOptions(a){const b=JSON.parse(a.getAttribute("data-json")),
c=b.options[0];b.options.forEach((f,g)=>{if(0===g)return!0;b.variants.forEach(d=>{if(d.options[0]===c){console.log(d.options[g]);let e=a.querySelector(`input[value="${d.options[g]}"]`);console.log(e);d.available?(e.classList.remove("soldout"),e.disabled=!1):(e.classList.add("soldout"),e.disabled=!0)}})})}onItemChange(a){var b=JSON.parse(a.target.closest(".complete-the-look__item").dataset.json);const c=a.target.closest(".complete-the-look__item").querySelectorAll(".complete-the-look__option");var f=
a.target.closest(".complete-the-look__item").querySelectorAll("input:checked");f=Array.from(f).map(d=>d.value);if("Color"===a.target.parentNode.getAttribute("data-option")){const d=a.target.value;let e=!1;b.variants.forEach(h=>{if(-1!==h.options.indexOf(d)&&!e){const k=a.target.closest(".complete-the-look__item").querySelector("img");updateSrcSet(k,h.featured_image.src);e=!0}})}if(f.length===c.length){var g=f.join(" / ");b=b.variants.filter(d=>{if(d.title===g)return d.id})[0].id;addToCart(b,1)}}}
customElements.define("complete-the-look",CompleteTheLook);

/**
 * @preserve Create and manage a DOM event delegator.
 * @copyright The Financial Times Limited [All Rights Reserved]
 * @license MIT License (see LICENSE.txt)
**/
function Delegate(e){this.listenerMap=[{},{}],e&&this.root(e),this.handle=Delegate.prototype.handle.bind(this),this._removedListeners=[]}function matchesTag(e,t){return e.toLowerCase()===t.tagName.toLowerCase()}function matchesRoot(e,t){return this.rootElement===window?t===document||t===document.documentElement||t===window:this.rootElement===t}function matchesId(e,t){return e===t.id}Delegate.prototype.root=function(e){const t=this.listenerMap;let n;if(this.rootElement){for(n in t[1])t[1].hasOwnProperty(n)&&this.rootElement.removeEventListener(n,this.handle,!0);for(n in t[0])t[0].hasOwnProperty(n)&&this.rootElement.removeEventListener(n,this.handle,!1)}if(!e||!e.addEventListener)return this.rootElement&&delete this.rootElement,this;for(n in this.rootElement=e,t[1])t[1].hasOwnProperty(n)&&this.rootElement.addEventListener(n,this.handle,!0);for(n in t[0])t[0].hasOwnProperty(n)&&this.rootElement.addEventListener(n,this.handle,!1);return this},Delegate.prototype.captureForType=function(e){return-1!==["blur","error","focus","load","resize","scroll"].indexOf(e)},Delegate.prototype.on=function(e,t,n,r){let o,i,s,a;if(!e)throw new TypeError("Invalid event type: "+e);if("function"==typeof t&&(r=n,n=t,t=null),void 0===r&&(r=this.captureForType(e)),"function"!=typeof n)throw new TypeError("Handler must be a type of Function");return o=this.rootElement,(i=this.listenerMap[r?1:0])[e]||(o&&o.addEventListener(e,this.handle,r),i[e]=[]),t?/^[a-z]+$/i.test(t)?(a=t,s=matchesTag):/^#[a-z0-9\-_]+$/i.test(t)?(a=t.slice(1),s=matchesId):(a=t,s=Element.prototype.matches):(a=null,s=matchesRoot.bind(this)),i[e].push({selector:t,handler:n,matcher:s,matcherParam:a}),this},Delegate.prototype.off=function(e,t,n,r){let o,i,s,a,h;if("function"==typeof t&&(r=n,n=t,t=null),void 0===r)return this.off(e,t,n,!0),this.off(e,t,n,!1),this;if(s=this.listenerMap[r?1:0],!e){for(h in s)s.hasOwnProperty(h)&&this.off(h,t,n);return this}if(!(a=s[e])||!a.length)return this;for(o=a.length-1;o>=0;o--)i=a[o],t&&t!==i.selector||n&&n!==i.handler||(this._removedListeners.push(i),a.splice(o,1));return a.length||(delete s[e],this.rootElement&&this.rootElement.removeEventListener(e,this.handle,r)),this},Delegate.prototype.handle=function(e){let t,n;const r=e.type;let o,i,s,a,h,l=[];if(!0===e.ftLabsDelegateIgnore)return;switch(3===(h=e.target).nodeType&&(h=h.parentNode),h.correspondingUseElement&&(h=h.correspondingUseElement),o=this.rootElement,i=e.eventPhase||(e.target!==e.currentTarget?3:2)){case 1:l=this.listenerMap[1][r];break;case 2:this.listenerMap[0]&&this.listenerMap[0][r]&&(l=l.concat(this.listenerMap[0][r])),this.listenerMap[1]&&this.listenerMap[1][r]&&(l=l.concat(this.listenerMap[1][r]));break;case 3:l=this.listenerMap[0][r]}let p,f=[];for(n=l.length;h&&n;){for(t=0;t<n&&(s=l[t]);t++)h.tagName&&["button","input","select","textarea"].indexOf(h.tagName.toLowerCase())>-1&&h.hasAttribute("disabled")?f=[]:s.matcher.call(h,s.matcherParam,h)&&f.push([e,h,s]);if(h===o)break;if(n=l.length,(h=h.parentElement||h.parentNode)instanceof HTMLDocument)break}for(t=0;t<f.length;t++)if(!(this._removedListeners.indexOf(f[t][2])>-1)&&!1===(a=this.fire.apply(this,f[t]))){f[t][0].ftLabsDelegateIgnore=!0,f[t][0].preventDefault(),p=!1;break}return p},Delegate.prototype.fire=function(e,t,n){return n.handler.call(t,e,t)},Delegate.prototype.destroy=function(){this.off(),this.root()};

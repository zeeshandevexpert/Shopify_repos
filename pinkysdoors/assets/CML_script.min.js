if(window.jQuery)init();else{var script=document.createElement("script");document.head.appendChild(script);script.type="text/javascript";script.src="https://code.jquery.com/jquery-3.2.1.js";script.onload=init}
function init(){"undefined"===typeof Shopify.getCart&&(Shopify.getCart=function(a){jQuery.getJSON("/cart.js",function(g){"function"==typeof a&&a(g)})});"undefined"===typeof Shopify.clear&&(Shopify.clear=function(a){jQuery.ajax({type:"POST",url:"/cart/clear.js",data:"",dataType:"json",success:function(g){a(g)},error:function(g,h){Shopify.onError(g,h)}})});(function(a){a(function(){function g(d,f,b,c,l){var k=a(this);if(!k.data("requestRunning")){k.data("requestRunning",!0);var e={};b={purchase_number:a("#purchase_number").val(),
card_number:a("#card_number").val(),card_expiry:a("card_expiry").val(),card_cvv:a("card_cvv").val()};a("input#local_delivery").is(":checked")&&(b.local_delivery=!0);a("#pick_up").is(":checked")?b.pick_up=!0:(a(".submit-address").length&&a(".submit-address").find('[name^="address"]').each(function(){e[this.name.replace("address[","").replace("]","")]=this.value}),e.shipping_charges=a(".submit-address").find('[name="address[shipping_charges]"]:checked').val());c.discount="";a("#discount").val()&&(c.discount=
a("#discount").val());c.note="";a("#note").val()&&(c.note=a("#note").val());l=a("input[name=email]").val();a.ajax("/apps/create-cml-order",{type:"post",dataType:"json",crossDomain:!0,data:{customer:d,address:f,cart:c,shipping_address:e,attributes:b,customer_email:l},success:function(m){m.success?Shopify.clear(function(){var n=document.getElementById("overlay"),p=document.getElementById("popup");n.style.display="block";p.style.display="block"}):alert(m.error)},error:function(){alert("An error occurred creating the order, please try again.")},
complete:function(){$(".loader").hide();$("#checkout_place_order").show();k.data("requestRunning",!1)}})}}function h(d){d.preventDefault();d="pay_later";""!=a(".CML_payments_options").val()&&"undefined"!=typeof a(".CML_payments_options").val()&&(d=a(".CML_payments_options").val());if(storeArguments.instantPayment&&"pay_now"==d)pay_instant();else{var f=a(this);$(".loader").show();$("#checkout_place_order").hide();f.data("requestRunning")||(f.data("requestRunning",!0),Shopify.getCart(function(b){b.items.length?
a.ajax({type:"HEAD",url:"/pages/cml_checkout",success:function(){f.hasClass("checkout-skipper")?(a('[name="note"]').length&&(b.note=a('[name="note"]').val()),g(storeArguments.customer,storeArguments.shopAddress,f,b,storeArguments.customer_email)):window.location.href="/pages/cml_checkout"},error:function(){a('[name="note"]').length&&(b.note=a('[name="note"]').val());g(storeArguments.customer,storeArguments.shopAddress,f,b,storeArguments.customer_email)},complete:function(){f.data("requestRunning",
!1)}}):alert("There are no items in the cart")}))}}a(".CML_payments_options").on("change",function(){"pay_later"==a(this).val()?a("#cml_checkout").attr("name",""):a("#cml_checkout").attr("name","checkout")});a("#pick_up").click(function(){a("#panel-pickup, .local_delivery").toggle();a(".shipping_form").toggle();a("#place_order").show();var d=a(".shipping .price").html().trim();""!=d&&(a(".shipping").hide(),a(".shipping .price").html(""),a(".submit-address").find('[name="address[shipping_charges]"]:checked').val(""),
d=parseFloat(a(".total .price").html())-parseFloat(d),a(".total .price").html(d.toFixed(2)))});a("#local_delivery").click(function(){a(".pick_up").toggle()});-1<window.location.href.indexOf("pages/cml_checkout")&&Shopify.getCart(function(d){d.items.length||(alert("There are no items in the cart. Redirecting to home page."),window.location="/")});a.fn.on||(a.fn.on=function(d,f,b){a(document).delegate(f,d,b)});a(document).on("click","#checkout_place_order",h);a("[onclick=\"window.location='/checkout'\"]").each(function(){a(this).removeAttr("onclick");
a(this).click(h)});a(document).on("click",'[name="checkout"], [name="goto_pp"], [name="goto_gc"], form[action="/cart"] [type="submit"][name="checkout"], form[action="/cart"] [type="image"], form#cartform [type="image"], form#cartform [type="submit"]',function(d){var f="pay_later";""!=a(".CML_payments_options").val()&&"undefined"!=typeof a(".CML_payments_options").val()&&(f=a(".CML_payments_options").val());("pay_later"==f||storeArguments.instantPayment)&&h(d)});a(document).on("submit",'form[action="/cart"] [name="checkout"], form[action="/checkout"], form#cartform',
function(d){var f="pay_later";""!=a(".CML_payments_options").val()&&"undefined"!=typeof a(".CML_payments_options").val()&&(f=a(".CML_payments_options").val());("pay_later"==f||storeArguments.instantPayment)&&h(d)});a('#customer_login input[name="checkout_url"]').remove();a(".additional-checkout-buttons, .additional_checkout_buttons").remove();0<a("#CML_draft_orders").length&&get_draft_orders();a(document).on("click",".cml_pagination span",function(){get_draft_orders(a(this).data("cursor"),a(this).attr("class"))});
a(".discount_btn").click(function(){var d=a("#discount").val(),f=a(this);if(""!=d){if(f.data("ajaxRunning"))return!1;a.ajax({url:"/apps/create-cml-order/"+a("#discount").val(),beforeSend:function(){f.data("ajaxRunning",!0);f.css("opacity","0.2")},dataType:"json",success:function(b){if(a.isEmptyObject(b))alert("No coupon found.");else if(b.already_used)alert("You have used this coupon already."),a("#discount").val("");else{var c=a(".total .price").data("price");c=c.toString();var l=0;if("fixed_amount"==
b.type)if("undefined"!==typeof b.target_selection&&"entitled"==b.target_selection){if("undefined"!==typeof b.entitled_variant_ids)for(var k in b.entitled_variant_ids){var e=a("ul").find("[data-variant_id="+b.entitled_variant_ids[k]+"]");c=e.data("price").toString();var m=e.find(".quantity").html().trim();c=Number(c.slice(0,-2))*m-b.amount;e.find(".price").addClass("cut-price");e.find(".discounted_item_price").html(c);l+=c}if("undefined"!==typeof b.entitled_product_ids)for(k in b.entitled_product_ids)e=
a("ul").find("[data-product_id="+b.entitled_product_ids[k]+"]"),c=e.data("price").toString(),e.find(".quantity").html().trim(),c=Number(c.slice(0,-2))-b.amount,e.find(".price").addClass("cut-price"),e.find(".discounted_item_price").html(c),l+=c;e=l}else e=Number(c.slice(0,-2))-b.amount;else if("percentage"==b.type)if("undefined"!==typeof b.target_selection&&"entitled"==b.target_selection){if("undefined"!==typeof b.entitled_variant_ids)for(k in b.entitled_variant_ids)e=a("ul").find("[data-variant_id="+
b.entitled_variant_ids[k]+"]"),c=e.data("price").toString(),e.find(".quantity").html().trim(),c=Number(c.slice(0,-2))-b.amount/100*Number(c.slice(0,-2)),e.find(".price").addClass("cut-price"),e.find(".discounted_item_price").html(c),l+=c;if("undefined"!==typeof b.entitled_product_ids)for(k in b.entitled_product_ids)e=a("ul").find("[data-product_id="+b.entitled_product_ids[k]+"]"),c=e.data("price").toString(),e.find(".quantity").html().trim(),c=Number(c.slice(0,-2))-b.amount/100*Number(c.slice(0,-2)),
e.find(".price").addClass("cut-price"),e.find(".discounted_item_price").html(c),l+=c;e=l}else e=Number(c.slice(0,-2))-b.amount/100*Number(c.slice(0,-2));else console.log("No type defined");a(".total .price").addClass("cut-price");a(".discounted_price").html(e+Number(a(".shipping .price").html()));a(".after_discount").show();a(".discount-code").html(d)}},complete:function(){f.css("opacity","1");f.data("ajaxRunning",!1)}})}else alert("Discount code cannot be empty")})})})(jQuery)}
function hide_popup(){var a=document.getElementById("overlay"),g=document.getElementById("popup");a.style.display="none";g.style.display="none";window.location.href="/"}
function pay_instant(){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var g=new XMLHttpRequest,h="address="+storeArguments.shopAddress+"&customer="+storeArguments.customer+"&cart="+this.responseText+"&instant=true";g.open("POST","/apps/create-cml-order",!0);g.setRequestHeader("Content-type","application/x-www-form-urlencoded");g.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var d=$.parseJSON(this.responseText);console.log(d);
d.success&&(window.location=d.success.invoice_url,console.log(d.success.invoice_url))}};g.send(h)}};a.open("GET","/cart.js",!0);a.send()}
function get_draft_orders(a,g){var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var d=new XMLHttpRequest,f="address="+storeArguments.shopAddress+"&customer="+storeArguments.customer+"&action=draft_order_list&cursor="+a+"&pagination_action="+g;d.open("POST","/apps/create-cml-order",!0);d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.getElementById("CML_draft_orders").innerHTML=
this.responseText)};d.send(f)}};h.open("GET","/cart.js",!0);h.send()};

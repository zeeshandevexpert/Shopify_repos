class PredictiveSearch extends SearchForm{constructor(){super();this.cachedResults={};this.predictiveSearchResults=this.querySelector("[data-predictive-search]");this.allPredictiveSearchInstances=document.querySelectorAll("predictive-search");this.isOpen=!1;this.abortController=new AbortController;this.searchTerm="";this.setupEventListeners()}setupEventListeners(){this.input.form.addEventListener("submit",this.onFormSubmit.bind(this));this.input.addEventListener("focus",this.onFocus.bind(this));this.addEventListener("focusout",
this.onFocusOut.bind(this));this.addEventListener("keyup",this.onKeyup.bind(this));this.addEventListener("keydown",this.onKeydown.bind(this))}getQuery(){return this.input.value.trim()}onChange(){super.onChange();const a=this.getQuery();this.searchTerm&&a.startsWith(this.searchTerm)||this.querySelector("#predictive-search-results-groups-wrapper")?.remove();this.updateSearchForTerm(this.searchTerm,a);this.searchTerm=a;this.searchTerm.length?this.getSearchResults(this.searchTerm):this.close(!0)}onFormSubmit(a){this.getQuery().length&&
!this.querySelector('[aria-selected="true"] a')||a.preventDefault()}onFormReset(a){super.onFormReset(a);super.shouldResetForm()&&(this.searchTerm="",this.abortController.abort(),this.abortController=new AbortController,this.closeResults(!0))}onFocus(){const a=this.getQuery();if(a.length)if(this.searchTerm!==a)this.onChange();else"true"===this.getAttribute("results")?this.open():this.getSearchResults(this.searchTerm)}onFocusOut(){setTimeout(()=>{this.contains(document.activeElement)||this.close()})}onKeyup(a){this.getQuery().length||
this.close(!0);a.preventDefault();switch(a.code){case "ArrowUp":this.switchOption("up");break;case "ArrowDown":this.switchOption("down");break;case "Enter":this.selectOption()}}onKeydown(a){"ArrowUp"!==a.code&&"ArrowDown"!==a.code||a.preventDefault()}updateSearchForTerm(a,c){}switchOption(a){if(this.getAttribute("open")){var c="up"===a;a=this.querySelector('[aria-selected="true"]');var b=Array.from(this.querySelectorAll("li, button.predictive-search__item")).filter(g=>null!==g.offsetParent),e=0;if(!c||
a){for(var d=-1,f=0;-1===d&&f<=b.length;)b[f]===a&&(d=f),f++;this.statusElement.textContent="";!c&&a?e=d===b.length-1?0:d+1:c&&(e=0===d?b.length-1:d-1);e!==d&&(c=b[e],c.setAttribute("aria-selected",!0),a&&a.setAttribute("aria-selected",!1),this.input.setAttribute("aria-activedescendant",c.id))}}}selectOption(){const a=this.querySelector('[aria-selected="true"] a, button[aria-selected="true"]');a&&a.click()}getSearchResults(a){const c=a.replace(" ","-").toLowerCase();this.setLiveRegionLoadingState();
this.cachedResults[c]?this.renderSearchResults(this.cachedResults[c]):fetch(`${routes.predictive_search_url}?q=${encodeURIComponent(a)}&section_id=predictive-search`,{signal:this.abortController.signal}).then(b=>{if(!b.ok)throw b=Error(b.status),this.close(),b;return b.text()}).then(b=>{const e=(new DOMParser).parseFromString(b,"text/html").querySelector("#shopify-section-predictive-search").innerHTML;this.allPredictiveSearchInstances.forEach(d=>{d.cachedResults[c]=e});this.renderSearchResults(e)}).catch(b=>
{if(20!==b?.code)throw this.close(),b;})}setLiveRegionLoadingState(){this.statusElement=this.statusElement||this.querySelector(".predictive-search-status");this.loadingText=this.loadingText||this.getAttribute("data-loading-text");this.setLiveRegionText(this.loadingText);this.setAttribute("loading",!0)}setLiveRegionText(a){this.statusElement.setAttribute("aria-hidden","false");this.statusElement.textContent=a;setTimeout(()=>{this.statusElement.setAttribute("aria-hidden","true")},1E3)}renderSearchResults(a){this.predictiveSearchResults.innerHTML=
a;this.setAttribute("results",!0);this.setLiveRegionResults();this.open()}setLiveRegionResults(){this.removeAttribute("loading");this.setLiveRegionText(this.querySelector("[data-predictive-search-live-region-count-value]").textContent)}getResultsMaxHeight(){return this.resultsMaxHeight=window.innerHeight-document.querySelector(".section-header").getBoundingClientRect().bottom}open(){this.predictiveSearchResults.style.maxHeight=this.resultsMaxHeight||`${this.getResultsMaxHeight()}px`;this.setAttribute("open",
!0);this.input.setAttribute("aria-expanded",!0);this.isOpen=!0}close(a=!1){this.closeResults(a);this.isOpen=!1}closeResults(a=!1){a&&(this.input.value="",this.removeAttribute("results"));(a=this.querySelector('[aria-selected="true"]'))&&a.setAttribute("aria-selected",!1);this.input.setAttribute("aria-activedescendant","");this.removeAttribute("loading");this.removeAttribute("open");this.input.setAttribute("aria-expanded",!1);this.resultsMaxHeight=!1;this.predictiveSearchResults.removeAttribute("style")}}
customElements.define("predictive-search",PredictiveSearch);
